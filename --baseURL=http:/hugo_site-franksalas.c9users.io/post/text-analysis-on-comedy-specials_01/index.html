<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Text Analysis on Comedy Specials:Part 1 - sal.as</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Francisco Salas" /><meta name="description" content="$Comedy\ is\ subjective.$ Comedy is about delivering a story that gets a laugh. What you find funny, someone else might find it offensive or even tragic. However, what do we know about comedy?
" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.54.0 with even 4.0.0" />


<link rel="canonical" href="//localhost:8080/post/text-analysis-on-comedy-specials_01/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.2b92dec5.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/custom.css">


<meta property="og:title" content="Text Analysis on Comedy Specials:Part 1" />
<meta property="og:description" content="

$Comedy\ is\ subjective.$

Comedy is about delivering a story that gets a laugh.
What you find funny, someone else might find it offensive or even tragic.
However, what do we know about comedy?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="//localhost:8080/post/text-analysis-on-comedy-specials_01/" />
<meta property="article:published_time" content="2019-02-26T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2019-02-26T00:00:00&#43;00:00"/>

<meta itemprop="name" content="Text Analysis on Comedy Specials:Part 1">
<meta itemprop="description" content="

$Comedy\ is\ subjective.$

Comedy is about delivering a story that gets a laugh.
What you find funny, someone else might find it offensive or even tragic.
However, what do we know about comedy?">


<meta itemprop="datePublished" content="2019-02-26T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-02-26T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="764">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Text Analysis on Comedy Specials:Part 1"/>
<meta name="twitter:description" content="

$Comedy\ is\ subjective.$

Comedy is about delivering a story that gets a laugh.
What you find funny, someone else might find it offensive or even tragic.
However, what do we know about comedy?"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-135004061-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-135004061-1');
</script>
</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">sal.as</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/cv/">
        <li class="mobile-menu-item"></li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">sal.as</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/cv/"></a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Text Analysis on Comedy Specials:Part 1</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-02-26 </span>
        <div class="post-category">
            <a href="/categories/web-scraping/"> web scraping </a>
            <a href="/categories/nlp/"> NLP </a>
            </div>
        
      </div>
    </header>

    
    <div class="post-content">
      <p><img src="/images/text-analysis-on-comedy-specials/nlp_comedy.png" alt="alt text" /></p>

<h1 id="comedy-is-subjective">$Comedy\ is\ subjective.$</h1>

<p>Comedy is about delivering a story that gets a laugh.
What you find funny, someone else might find it offensive or even tragic.
However, what do we know about comedy?</p>

<p>Is there an actual formula? If so how would one explain it with emoticons?</p>

<h2 id="formula">Formula</h2>

<blockquote>
<h1 id="delta-t">ðŸ˜† $=$ ðŸ˜¢ $+ \Delta t$</h1>

<p>Where, $Comedy$, noted by ðŸ˜† is the sum an event causing great suffering relative one or a group of people,  noted by ðŸ˜¢,  and the passing of time relative to one or a group of people, noted by $\Delta t$.</p>
</blockquote>

<div class='align-center'>
  <p><img src="https://media1.tenor.com/images/13343855f70f08e103604eb64bcb5a7a/tenor.gif?itemid=10089177" alt="" /></p>

</div>

<div class='align-center'>
  <blockquote>
<p><strong>ok fine!</strong></p>
</blockquote>

</div>

<p>In what it looks like a multipart tutorial, in  <strong>PART 1</strong> we will extract the transcript text for several standups that were televised over the years.</p>

<h2 id="data-extraction">Data Extraction</h2>

<p>To my knowledge, there is no public API for standups specials or anything related to comedy, so we need to get our data somewhere else.</p>

<p>While searching, I stumbled on <strong><a href="https://scrapsfromtheloft.com">scrapsfromtheloft.com</a></strong> which had quite a few transcripts from several standup specials.</p>

<p>We will get our data from <a href="https://scrapsfromtheloft.com/tag/stand-up-transcripts/">https://scrapsfromtheloft.com/tag/stand-up-transcripts/</a></p>

<h1 id="understanding-the-structure-of-the-page">Understanding the structure of the page</h1>

<p>Before we get coding, we need to find what data we need to extract and how its displayed on the page.</p>

<p>Under <code>https://scrapsfromtheloft.com/tag/stand-up-transcripts/</code> is a list of posts with the tag <code>stand-up-transcripts</code></p>

<p><img src="/images/text-analysis-on-comedy-specials/post_00.PNG" alt="alt text" /></p>

<div class="admonition abstract"><p class="admonition-title">data to extract</p>
  <ul>
<li>name of comedy special</li>
<li>link to the transcript text</li>
<li>name of the comedian</li>
<li>summary text of the special</li>
</ul>

</div>

<p>Under Chrome we can inspect the page with the keyboard shortcut <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>I</kbd>, or  by right cliking and selecting &ldquo;inspect&rdquo;.</p>

<p>We can see that each post is under <code>&lt;div class='fusion-post-content post-content'&gt;</code></p>

<ul>
<li>The title and transcript link are under the <code>&lt;H2&gt;</code> and <code>&lt;a&gt;</code> tag respectively</li>
<li>We can extract the name of the comedian from the list of tags under <code>&lt;span class='meta-tags'&gt;</code></li>
<li>The summary text is under <code>&lt;div class='fusion-post-content-container'&gt;</code></li>
</ul>

<p><img src="/images/text-analysis-on-comedy-specials/blog_post0.png" alt="alt text" /></p>

<h2 id="web-scraping">Web Scraping</h2>

<div class="admonition abstract"><p class="admonition-title">tools &amp; libraries</p>
  <ul>
<li>Python</li>
<li>requests</li>
<li>BeautifulSoup</li>
<li>Pandas</li>
<li>Jupyter Notebook</li>
</ul>

</div>

<p>Now that we know what data to extract,  we will need to find a way to  download the page.</p>

<p>I found a <a href="https://www.peterbe.com/plog/best-practice-with-retries-with-requests">great blog</a> post on best practice on how to use requests so I will modify some of his code to fit my need.</p>

<h3 id="steps">Steps</h3>

<ol>
<li>create a functon called<code>requests_retry_session()</code> that extracts data from webpage</li>
<li>create a function to called <code>get_response()</code>  that calls <code>request_retry_session()</code> and handles errors and exceptions.</li>
<li>create a function called <code>bs_parser_post()</code> that parses and extracts the requierd data using Beautiful soup.</li>
<li>create a dataframe with the extracted data</li>
</ol>

<pre><code class="language-python"># libraries to import
import requests
import time
from requests.adapters import HTTPAdapter
from requests.packages.urllib3.util.retry import Retry
from bs4 import BeautifulSoup
import pandas as pd
import numpy as np
from IPython.core.display import clear_output
from warnings import warn
import os
</code></pre>

<pre><code class="language-python"># source: https://www.peterbe.com/plog/best-practice-with-retries-with-requests

# handles the request call
def requests_retry_session(retries=3,backoff_factor=0.3,status_forcelist=(500, 502, 504),session=None,):
    ''' creates request session w/several parameters returns: session '''
    session = session or requests.Session()
    retry = Retry(
        total=retries,
        read=retries,
        connect=retries,
        backoff_factor=backoff_factor,
        status_forcelist=status_forcelist,
    )
    adapter = HTTPAdapter(max_retries=retry)
    session.mount('http://', adapter)
    session.mount('https://', adapter)
    return session

# calls requests_retry_session() &amp; handles any exceptions or errors
def get_response(url):
    '''calls requests_retry_session(), handles errors returns request data'''
    t0 = time.time()
    try:
        response = requests_retry_session().get(
            url,
            timeout=10
        )
        return response
    except Exception as x:
        print('It failed :(', x.__class__.__name__)
    else:
        print('It eventually worked', response.status_code)
    finally:
        t1 = time.time()
        print('Took', t1 - t0, 'seconds')

def bs_parser_post(response):
    ''' extractd data from request call given div classes, returns 4 lists with selected data'''
    titles = []
    summaries = []
    links = []
    tags = []
    page_html = BeautifulSoup(response.text, 'html.parser')
    containers = page_html.find_all('div', class_ = 'fusion-post-content post-content')
    for i in containers:
        titles.append(i.h2.text)  # title
        links.append(i.a['href'])  # link to transcript
        tags.append(i.select('span')[6].get_text(strip=True)[5:])  # name of comedian
        summaries.append(i.find('div', class_ = 'fusion-post-content-container').p.text)  # summary text
    return titles,summaries,tags,links
</code></pre>

<pre><code class="language-python"># run our code

url = 'https://scrapsfromtheloft.com/tag/stand-up-transcripts/'
response = get_response(url)
titles,summaries,tags,links = bs_parser_post(response)

df = pd.DataFrame({'raw_title': titles,
                   'summary': summaries,
                   'tags':tags,
                   'link': links})
</code></pre>

<pre><code class="language-python"># check dataframe
df.info()
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 244 entries, 0 to 243
Data columns (total 4 columns):
raw_title    244 non-null object
summary      244 non-null object
tags         244 non-null object
link         244 non-null object
dtypes: object(4)
memory usage: 7.7+ KB
</code></pre>

<h2 id="results">Results</h2>

<p><img src="/images/text-analysis-on-comedy-specials/post_13.PNG" alt="alt text" /></p>

<p>We now have a dataframe with the data we scraped but it needs some cleaning.</p>

<p>We can clean up the tag column to display the name only.</p>

<pre><code class="language-python">df.tags = df.tags.str.replace('Stand-up transcripts','')
df.tags = df.tags.str.replace('Gun control','')
df.tags = df.tags.str.replace('SATURDAY NIGHT LIVE','')
df.tags = df.tags.str.replace('Abortion','')
df.tags = df.tags.str.replace('Religion','')
df.tags = df.tags.str.replace(',','')

# Correct name text
df.tags = df.tags.str.title()
</code></pre>

<p>Change the tag column name and reorder the columns</p>

<pre><code class="language-python"># rename column
df.rename(columns={&quot;tags&quot;: &quot;name&quot;},inplace=True)

# order columns
df = df[['name','raw_title','summary','link']]

df.head()
</code></pre>

<p><img src="/images/text-analysis-on-comedy-specials/post_14.PNG" alt="alt text" /></p>

<p>Thats enough for today.</p>

<p>On the next tutorial we will extract the transcript text from each link in our dataframe.</p>

<p><a href="https://github.com/franksalas/comedy_text_analysis/blob/master/notebook/01_get_list.ipynb">NOTEBOOK LINK</a></p>
    </div>

    <footer class="post-footer">
      
      <nav class="post-nav">
        
        <a class="next" href="/post/create-alias-for-windows-app/">
            <span class="next-text nav-default">Create Alias for Windows App</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:frank.salas@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="http://bit.ly/infranksalas" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="http://bit.ly/ghfranksalas" class="iconfont icon-github" title="github"></a>
  <a href="//localhost:8080/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">

  <script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Support Me on Ko-fi', '#34495E', 'K3K4QVF2');kofiwidget2.draw();</script> 

  

  <span class="copyright-year">
    &copy; 
    2016 - 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Francisco Salas</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.afb34c68.min.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      TeX: {equationNumbers: {autoNumber: "AMS"}},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








<script data-no-instant>document.write('<script src="/livereload.js?port=8080&mindelay=10"></' + 'script>')</script></body>
</html>
